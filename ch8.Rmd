---
title: "迴圈與流程控制"
author: "郭耀仁"
date: "`r Sys.Date()`"
output: slidy_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, results = 'hide', warning = FALSE)
```

## 迴圈

- 善用迴圈讓你能夠寫出簡短的程式碼
    - for 迴圈
    - while 迴圈
    
## 迴圈（2）

- R 語言有一個內建的向量 `month.name`
- 我想要把它所有的內容一一輸出在命令列
- 其實土法煉鋼沒什麼不好：

```{r}
month.name[1]
month.name[2]
month.name[3]
month.name[4]
month.name[5]
month.name[6]
month.name[7]
month.name[8]
month.name[9]
month.name[10]
month.name[11]
month.name[12]
```

## 迴圈（3）

- 今天運氣好，`month.name` 只有 12 個元素
- `for` 迴圈長這個樣子：

```{r}
# for 迴圈
for (i in month.name) {
  print(i)
}
```

## 迴圈（4）

- 巢狀迴圈（nested loop）是指迴圈包含另一個迴圈
- 我們利用填滿一個矩陣來展示

```{r}
my_mat <- matrix(nrow = 2, ncol = 3)
my_vector <- 1:6
for (j in 1:ncol(my_mat)) {
  for (i in 1:nrow(my_mat)) {
    my_mat[i, j] <- my_vector[1]
    my_vector <- my_vector[-1] # 每跑完一次迴圈要丟掉第一個元素
  }
}
```

## 迴圈（5）

- 矩陣是 3 * 3，但是向量只有 4 個
- 沒有填滿的就是 NA

```{r}
my_vector <- 1:4
my_mat <- matrix(nrow = 3, ncol = 4)
for (j in 1:ncol(my_mat)){
  for (i in 1:nrow(my_mat)){
    my_mat[i, j] <- my_vector[1]
    my_vector <- my_vector[-1] # 每跑完一次迴圈要丟掉第一個元素
  }
}
```

## 迴圈（6）

- `while` 迴圈會先檢查條件才執行程式碼

```{r}
i <- 1
while (i <= length(month.name)) {
  print(month.name[i])
  i <- i + 1
}
```

## 流程控制

- 一如其他的程式語言，R 語言也習慣使用 `if-else` 的語法來進行流程控制：

```{r}
x <- 2 # 修改 x 看看結果有何不同？
# 兩個分支的流程控制
if (x %% 2 == 0) {
  print("x 是一個偶數！")
} else {
  print("x 是一個奇數！")
}
```

## 流程控制（2）

- 多個分支要採用 `if-else if-else` 的語法來進行流程控制：

```{r}
x <- 5 # 修改 x 看看結果有何不同？
# 三個分支的流程控制
if (x %% 3 == 0) {
  print("x 除以 3 的餘數為 0！")
} else if (x %% 3 == 1) {
  print("x 除以 3 的餘數為 1！")
} else {
  print("x 除以 3 的餘數為 2！")
}
```

## 流程控制（3）

- 太多分支會降低程式碼的可讀性（readability），這時可以考慮使用 `switch()` 函數
- 但是 `switch()` 函數處理整數時只接受從 1 開始的回傳數值，所以要處理成字元

```{r}
x <- 6
answer <- x %% 3
switch(as.character(answer),
  "0" = {
    print("x 除以 3 的餘數為 0！")
  },
  "1" = {
    print("x 除以 3 的餘數為 1！")
  },
  "2" = {print("x 除以 3 的餘數為 2！")
  }
)
```

## 迴圈（5）

- 在迴圈中加入 `break` 或 `next` 讓你的程式更有彈性

```{r}
for (i in month.name) {
  if (i == "September") {
    break
  }
  print(i)
}

for (i in month.name) {
  if (i == "September") {
    next
  }
  print(i)
}
```

## `for` 與 `while` 的使用時機

- 所有的 `for` 都可以用 `while` 改寫
- 但是反過來並非如此
- 不知道迭代次數的時候用 `while`

## `for` 與 `while` 的使用時機（2）

- 投擲一個公正的銅板，必須出現三次正面才可以停止
- 請問總共要投幾次？

```{r}
coin_flips <- c()
coin <- c(TRUE, FALSE) # TRUE 代表正面，FALSE 代表反面
i <- 1

while (sum(coin_flips) < 3){
  coin_flips[i] <- sample(coin, size = 1)
  i <- i + 1
}
coin_flips # 投擲紀錄
length(coin_flips) # 總共投了幾次
```

## 隨堂練習

[迴圈與流程控制 - 隨堂練習](https://yaojenkuo.github.io/r_programming/ch8_exercise)

## 期中作業

我們把這個公正的**銅板**改成公正的**骰子**，必須出現三次六點才可以停止，請問總共要投幾次？

```{r}
dice <- 1:6
sample(dice, size = 1)
```